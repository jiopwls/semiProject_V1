<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://ultraq.net.nz/thymeleaf/layout"
layout:decorate="~{fragments/layout}"
>

<th:block layout:fragment="mystyle">
	<style>
	
		table {
        width: 100%;
        margin-top: 50px;
    }

    th,
    td {
        text-align: center;
        padding: 5px;
    }

    thead {
        background: skyblue;

    }

    tbody tr:nth-child(2n) {
        background: rgba(135, 207, 235, 0.401);
    }
	tbody tr:last-child {
		background:none;
		height:40px;
	}
    #newbtn {
        display: block;
        float: right;
        margin-right:3px;
        padding: 3px 5px;
        background:none;
        border:1px solid black;
    }
	#newbtn:hover{
	cursor:pointer;
	}
    .reset {
        font-weight: normal !important;
        padding:0px 3px;
    }

    .font-up {
        font-size: 26px;
        vertical-align: top;
        display: inline-block;
        /* position: relative; */
        margin-top: -7px;
        padding: 0 2px!important;
    }
    .cpage{font-weight:bold; color:red; font-size:18px; padding:0 4px!important;}
    .reset{font-weight:normal;}
    #find_box{
    	position:absolute;
    	vertical-align:center;
    }
    #find_box input,
    #find_box button{
    	vertical-align:bottom;
    }
    #fval {
    	padding-left:5px;
    	width:150px;
    	height:23px;
    }
    #fkey{
    	height:23px;
    }
    #findBtn{
	    background:none;
	    border:none;
	    left:-23px;
	    position:relative;
	    top:-1px;
	    cursor:pointer;
    }
	#findBtn i{
		font-size:15px;
	}
	</style>
</th:block>

<th:block layout:fragment="main">
	<div id="main" th:with="cpg=${(param.cpg == null)? 1:T(java.lang.Integer).parseInt(param.cpg)}">
		<h1 th:with="fqry=(${#httpServletRequest.queryString})">게시판 목록 [[${param.fkey}]] [[${param.fval}]]</h1>
		<!--
			1. not session.isEmpty()
			2. not #string.isEmpty(session.m)
			3.th:disabled="${session.m == null}"
			
		-->
		<div id="find_box">
			<select name="fkey" id='fkey'>
				<option value="title" >제목</option>
				<option value="userid" >작성자</option>
				<option value="contents">본문</option>
			</select>
			<input name="fval" id="fval" type="text" placeholder="검색하기">
			<button type="button" id="findBtn">
				<i class="bi bi-search"></i>
			</button>
		</div>
		<button type="button" th:if="${#strings.isEmpty(session.m)}" style="display:none;"></button>
		<button type="button" id="newbtn" th:unless="${#strings.isEmpty(session.m)}">새글쓰기</button>
		
		<table>
			<colgroup>
				<col style="width:10%;">
				<col style="width:50%">
				<col style="width:15%">
				<col style="width:15%">
				<col style="width:10%">
			</colgroup>
			<thead>
				<tr>
					<th>번호</th>
					<th>제목</th>
					<th>작성자</th>
					<th>작성일</th>
					<th>조회수</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="b: ${bdlist}">
					<td th:text="${b.b_no}"></td>
					<td>
						<a th:href="@{/view(b_no=${b.b_no})}" th:text="${b.title}" class="reset"></a>
					</td>
					<td th:text="${b.userid}"></td>
					<td th:text="${#strings.substring(b.regdate,0,10)}"></td>
					<td th:text="${b.views}"></td>
				</tr>
				
				<tr>
					<td colspan="5">
					<span class="font-up">
						<a th:href="@{/list(cpg=${cpg - 10},fkey=${param.fkey},fval=${param.fval})}" th:if="${cpg > 10}"class="reset">&laquo;</a>
						<span th:if="${cpg < 11}"class="reset">&laquo;</span>
                    	<a th:href="@{/list(cpg=${cpg - 1},fkey=${param.fkey},fval=${param.fval})}" th:if="${cpg > 1}" class="reset">&lsaquo;</a>
                    	<span th:unless="${cpg > 1}" class="reset">&lsaquo;</span>
					 </span>
                        <th:block th:each="i : ${#numbers.sequence(0,9)}">
	                       <th:block th:if="${(stpgn + i) <= pages}">
		                       	<span th:text="${stpgn + i}" th:if="${cpg == (stpgn + i)}" class="cpage"></span>
		                       	<span th:unless="${cpg == (stpgn + i)}">
		                       	  <a th:href="@{/list(cpg=${stpgn + i},fkey=${param.fkey},fval=${param.fval})}" class="reset">[[${stpgn + i}]]</a>
		                       	</span>
                        	</th:block>
                        </th:block>
                    <span class="font-up">
                    	<a th:if="${cpg < pages}" th:href="@{/list(cpg=${cpg + 1},fkey=${param.fkey},fval=${param.fval})}"class="reset">&rsaquo;</a>
                    	<span th:unless="${cpg < pages}" th:href="@{/list(cpg=${cpg + 1},fkey=${param.fkey},fval=${param.fval})}"class="reset">&rsaquo;</span>
                    	<a th:if="${cpg < (pages - 10) }" th:href="@{/list(cpg=${cpg + 10},fkey=${param.fkey},fval=${param.fval})}"class="reset">&raquo;</a>
                    </span>
                    </td>
				</tr>
			</tbody>
		</table>
	</div>
</th:block>

<th:block layout:fragment="myscript">
	<script>
		// emcascript 2020 지원시 - 최신 브라우저 사용시
		// Cannot read properties of null (reading 'addEventListener') 세련되게 처리하기
		// optional chaining 사용 -> 객체?.addEventListener
		
		let newbtn = document.getElementById('newbtn');
		newbtn?.addEventListener('click',go2new);
		
		// 검색시 요청 url : /list?fkey=title&fval=내용
		let findbtn = document.getElementById('findBtn');
		findbtn.addEventListener('click', () => {
			let fkey = document.querySelector("#fkey");
			let fval = document.querySelector("#fval");
			if(fval.value =="") alert('찾으실 내용을 입력해주세요.');
			else {
				let qry = '?fkey=' + fkey.value;
				qry += '&fval=' + fval.value;
				location.href = '/list' + qry;
			}
		});
		
		function go2new(){
			location.href = '/write';
		}
	</script>
</th:block>
</html>